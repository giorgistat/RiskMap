% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/spatial_prediction.R
\name{pred_target_shp}
\alias{pred_target_shp}
\title{Predictive Targets over a Shapefile (grid-aggregated)}
\usage{
pred_target_shp(
  object,
  shp,
  shp_target = mean,
  weights = NULL,
  standardize_weights = FALSE,
  col_names = NULL,
  include_covariates = TRUE,
  include_nugget = FALSE,
  include_cov_offset = FALSE,
  include_mda_effect = TRUE,
  return_shp = TRUE,
  time_pred = NULL,
  mda_grid = NULL,
  include_re = FALSE,
  f_target = NULL,
  pd_summary = NULL,
  messages = TRUE,
  return_target_samples = FALSE
)
}
\arguments{
\item{object}{Output from \code{\link{pred_over_grid}} (class \code{RiskMap.pred.re}),
typically fitted with \code{type = "joint"} so that linear predictor samples are available.}

\item{shp}{An \pkg{sf} polygon object (preferred) or a \code{data.frame} with an
attached geometry column, representing regions over which predictions are aggregated.}

\item{shp_target}{A function that aggregates grid-cell values within each polygon to a
single regional value (default \code{mean}). Examples: \code{mean}, \code{sum},
a custom weighted mean, etc.}

\item{weights}{Optional numeric vector of weights used inside \code{shp_target}.
If supplied with \code{standardize_weights = TRUE}, weights are normalized within each region.}

\item{standardize_weights}{Logical; standardize \code{weights} within each region (\code{FALSE} by default).}

\item{col_names}{Name or column index in \code{shp} containing region identifiers to use in outputs.}

\item{include_covariates}{Logical; include fitted covariate effects in the linear predictor (default \code{TRUE}).}

\item{include_nugget}{Logical; include the nugget (unstructured measurement error) in the linear predictor (default \code{FALSE}).}

\item{include_cov_offset}{Logical; include any covariate offset term (default \code{FALSE}).}

\item{include_mda_effect}{Logical; include the MDA effect as defined by the fitted DAST model
(default \code{TRUE}). Requires \code{time_pred} and, when applicable, \code{mda_grid}.}

\item{return_shp}{Logical; if \code{TRUE}, return the shapefile with appended summary columns
defined by \code{pd_summary} (default \code{TRUE}).}

\item{time_pred}{Optional numeric scalar (or time index) at which to evaluate the predictive target}

\item{mda_grid}{Optional structure describing MDA schedules aligned with prediction grid cells
(e.g., a \code{data.frame}/matrix/list). Used only when \code{include_mda_effect = TRUE}.}

\item{pd_summary}{List of summary functions (e.g., mean, sd) to summarize target samples.}

\item{return_target_samples}{Logical indicating whether to return raw samples of the predictive targets for each region (default is FALSE).}
}
\value{
An object of class 'RiskMap_pred_target_shp' containing:
\itemize{
  \item \code{target} – summaries of predictive targets by region.
  \item \code{target_samples} – raw samples of predictive targets (if \code{return_target_samples=TRUE}).
  \item \code{shp} – spatial object with appended summary statistics.
  \item \code{f_target}, \code{pd_summary}, \code{grid_pred}.
}
}
\description{
Computes predictive targets over polygon features using joint prediction
samples from \code{\link{pred_over_grid}}. Targets can incorporate
covariates, offsets, optional unstructured random effects, and (if fitted)
mass drug administration (MDA) effects from a DAST model.
}
\details{
For each polygon in \code{shp}, grid-cell samples of the linear predictor are transformed with
\code{f_target}, optionally adjusted for covariates, offset, nugget, MDA effects and/or REs, and
then aggregated via \code{shp_target} (optionally weighted). The list \code{pd_summary} is applied
to each region's target samples to produce summary statistics.
}
\seealso{
\code{\link{pred_over_grid}}, \code{\link{pred_target_grid}}
}
